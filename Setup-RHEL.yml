---
- name: install EPEL (RHEL 5)
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version|int == 5
  shell: rpm -Uvh http://mirror.pnl.gov/epel/5/i386/epel-release-5-4.noarch.rpm
  ignore_errors: true
- name: install EPEL (RHEL 6)
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version|int == 6
  yum: name=http://mirror.pnl.gov/epel/6/i386/epel-release-6-8.noarch.rpm state=present
- name: install EPEL (RHEL 7)
  when: ansible_os_family == "RedHat" and ansible_distribution_major_version|int == 7
  yum: name=http://mirror.pnl.gov/epel/7/x86_64/e/epel-release-7-5.noarch.rpm state=present
- name: install "core" packages (RHEL)
  yum: name={{ item }} state=latest
  with_items:
    - openssh-clients
    - vim-enhanced
    - screen
    - tmux
    - curl
    - wget
    - lynx
    - links
    - sudo
    - libselinux-python
    - git
    - rsync
    - nmap
    - nc
    - strace
    - bind-utils
    - iotop
    - htop
    - mlocate
- name: install rsyslog on non-systemd
  when: ansible_service_mgr != "systemd"
  yum: name=rsyslog state=latest
- name: update system (RHEL)
  yum: name=* state=latest
- name: install vmware tools (RHEL/vmware)
  yum: name=open-vm-tools state=latest
  when: ansible_os_family == "RedHat" and ansible_virtualization_type == "VMware"

- name: set selinux to permissive
  selinux: policy=targeted state=permissive
- name: set timezone to UTC (RHEL)
  file: state=link src=/usr/share/zoneinfo/UTC path=/etc/localtime