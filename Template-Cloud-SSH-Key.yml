---
- name: clear init legacy
  when: ansible_os_family == "RedHat"
  shell: chkconfig --del cloudstack-set-guest-sshkey
  ignore_errors: true
  
- name: add cloud-set-guest-sshkey script (dhclient)
  when: ansible_os_family == "RedHat" or ansible_os_family == "Debian" or ansible_os_family == "Ubuntu" or ansible_os_family == "Mageia"
  template: src=templates/dhclient/cloud-set-guest-sshkey.j2 dest=/usr/share/cloudstack/cloudstack-set-guest-sshkey mode=0755

- name: add cloud-set-guest-sshkey script (wicked)
  when: ansible_os_family == "Suse" or ansible_os_family == "openSUSE Leap"
  template: src=templates/wicked/cloud-set-guest-sshkey.j2 dest=/usr/share/cloudstack/cloudstack-set-guest-sshkey mode=0755

- name: add cloud-set-guest-sshkey script (FreeBSD)
  when: ansible_os_family == "FreeBSD"
  template: src=templates/FreeBSD/cloud-set-guest-sshkey-freebsd.j2 dest=/usr/share/cloudstack/cloudstack_set_guest_sshkey mode=0755

- name: setup cloudstack-set-guest-sshkey (sysvinit)
  when: ansible_service_mgr == "sysvinit" or ansible_service_mgr == "init\n"
  file: state=link src=/usr/share/cloudstack/cloudstack-set-guest-sshkey dest=/etc/init.d/cloudstack-set-guest-sshkey mode=0755 force=yes

- name: setup cloudstack-set-guest-sshkey (upstart)
  when: ansible_service_mgr == "upstart"
  template: src=templates/upstart/set-guest-sshkey.upstart.j2 dest=/etc/init/cloudstack-set-guest-sshkey.conf mode=0644

- name: setup cloudstack-set-guest-sshkey (systemd)
  when: ansible_service_mgr == "systemd"
  template: src=templates/systemd/set-guest-sshkey.systemd.j2 dest=/etc/systemd/system/cloudstack-set-guest-sshkey.service mode=0644 
